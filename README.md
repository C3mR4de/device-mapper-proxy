# device-mapper-proxy

Модуль ядра Linux для сбора статистики выполняемых операций (чтение/запись) на виртуальном блочном устройстве.
Тестировался на дистрибутиве Arch Linux с ядром `6.12.29-1-lts`.

## Подготовка

Устанавливаем все необходимые зависимости:

```pacman -Syu base-devel kmod device-mapper sysfsutils linux-lts-headers gcc make```

В случае, если используется стандартное ядро `linux` или другая его модификация (например, `linux-zen`), следует вместо пакета `linux-lts-headers` установить соответствующий пакет заголовочных файлов.

Команда `make` выполнит сборку, подготовку окружения, тестирование и возврат окружения в исходное состояние.

## Сборка

Собрать модуль ядра:

```make build```

Удалить файлы, полученные в результате сборки:

```make clean```

## Тестирование

Скрипт для тестирования прописан в Makefile. Он условно поделён на 3 блока:

1. `test_init`

Инициализирует окружение для тестирования (подключает скомпилированный модуль, создаёт тестовое блочное устройство, создаёт proxy-устройство).

2. `test_exec`

Выполняет операции чтения/записи при помощи программы `dd` (путём побайтового копирования) и выводит статистику.

3. `test_fini`

Деинициализирует окружение (удаляет виртуальные блочные устройства и выгружает модуль).

Запустить тесты можно при помощи следующей команды (предварительно нужно собрать модуль ядра при помощи ```make build```):

```make test```
